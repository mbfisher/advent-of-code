package main

import (
	"bufio"
	"strings"
	"testing"
)

var exampleInput = `L.LL.LL.LL
LLLLLLL.LL
L.L.L..L..
LLLL.LL.LL
L.LL.LL.LL
L.LLLLL.LL
..L.L.....
LLLLLLLLLL
L.LLLLLL.L
L.LLLLL.LL`

func TestDoRound(t *testing.T) {
	scanner := bufio.NewScanner(strings.NewReader(exampleInput))
	seats := parse(scanner)

	tests := []struct {
		result string
	}{
		{`#.##.##.##
#######.##
#.#.#..#..
####.##.##
#.##.##.##
#.#####.##
..#.#.....
##########
#.######.#
#.#####.##
`},
		{`#.LL.L#.##
#LLLLLL.L#
L.L.L..L..
#LLL.LL.L#
#.LL.LL.LL
#.LLLL#.##
..L.L.....
#LLLLLLLL#
#.LLLLLL.L
#.#LLLL.##
`},
		{`#.##.L#.##
#L###LL.L#
L.#.#..#..
#L##.##.L#
#.##.LL.LL
#.###L#.##
..#.#.....
#L######L#
#.LL###L.L
#.#L###.##
`},
		{`#.#L.L#.##
#LLL#LL.L#
L.L.L..#..
#LLL.##.L#
#.LL.LL.LL
#.LL#L#.##
..L.L.....
#L#LLLL#L#
#.LLLLLL.L
#.#L#L#.##
`},
		{`#.#L.L#.##
#LLL#LL.L#
L.#.L..#..
#L##.##.L#
#.#L.LL.LL
#.#L#L#.##
..L.L.....
#L#L##L#L#
#.LLLLLL.L
#.#L#L#.##
`},
	}

	for i, tt := range tests {
		seats = doRound(seats, 1, 4)
		result := stringify(seats)
		if result != tt.result {
			t.Errorf("round %d failed", i+1)
			t.Log(result)
		}
	}
}

func TestDoRoundDistance(t *testing.T) {
	scanner := bufio.NewScanner(strings.NewReader(exampleInput))
	seats := parse(scanner)

	tests := []struct {
		result string
	}{
		{`#.##.##.##
#######.##
#.#.#..#..
####.##.##
#.##.##.##
#.#####.##
..#.#.....
##########
#.######.#
#.#####.##
`},
		{`#.LL.LL.L#
#LLLLLL.LL
L.L.L..L..
LLLL.LL.LL
L.LL.LL.LL
L.LLLLL.LL
..L.L.....
LLLLLLLLL#
#.LLLLLL.L
#.LLLLL.L#
`},
		{`#.L#.##.L#
#L#####.LL
L.#.#..#..
##L#.##.##
#.##.#L.##
#.#####.#L
..#.#.....
LLL####LL#
#.L#####.L
#.L####.L#
`},
		{`#.L#.L#.L#
#LLLLLL.LL
L.L.L..#..
##LL.LL.L#
L.LL.LL.L#
#.LLLLL.LL
..L.L.....
LLLLLLLLL#
#.LLLLL#.L
#.L#LL#.L#
`},
		{`#.L#.L#.L#
#LLLLLL.LL
L.L.L..#..
##L#.#L.L#
L.L#.#L.L#
#.L####.LL
..#.#.....
LLL###LLL#
#.LLLLL#.L
#.L#LL#.L#
`},
		{`#.L#.L#.L#
#LLLLLL.LL
L.L.L..#..
##L#.#L.L#
L.L#.LL.L#
#.LLLL#.LL
..#.L.....
LLL###LLL#
#.LLLLL#.L
#.L#LL#.L#
`},
	}

	for i, tt := range tests {
		seats = doRound(seats, -1, 5)
		result := stringify(seats)
		t.Log(result)
		if result != tt.result {
			t.Fatalf("round %d failed", i+1)
		}
	}
}

func TestCountOccupied(t *testing.T) {
	scanner := bufio.NewScanner(strings.NewReader(exampleInput))
	result := countOccupied(scanner, 1, 4)
	if result != 37 {
		t.Errorf("got %d want %d", result, 37)
	}
}
